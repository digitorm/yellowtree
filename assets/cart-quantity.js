import BaseComponent from"./base-component.js";customElements.define("cart-quantity",class extends BaseComponent{elements={qtyInput:"[data-input]",minusButton:"[data-minus-button]",plusButton:"[data-plus-button]"};render(){this.qtyValue=+this.$qtyInput.value,this.variantId=this.getAttribute("cart-item-variant-id"),this.variantQtyLimit=+this.$qtyInput.max,this._handleButtonsClick()}_handleButtonsClick(){this.$plusButton.addEventListener("click",()=>this._validateInput(1)),this.$minusButton.addEventListener("click",()=>this._validateInput(-1)),this.$qtyInput.addEventListener("change",()=>this._validateInput())}_validateInput(t){this._disableInput();t=t?this.qtyValue+t:+this.$qtyInput.value;if(t<1||t>this.variantQtyLimit)return this.$qtyInput.value=this.qtyValue,void this._enableInput();this.qtyValue=t,this._updateUI(),this._requestCartChanges()}_disableInput(){this.classList.add("loading")}_onDirectInput(){var t=+this.$qtyInput.value;if(t<1||t>this.variantQtyLimit)return alert("Incorrect quantity!"),void(this.$qtyInput.value=this.qtyValue);this._updateQtyValue(t)}_updateQtyValue(t){this.qtyValue+=t,this._requestCartChanges()}_onCartResponse(t){this.currentDataItem=t.items.find(t=>t.id===+this.variantId),this.currentDataItem&&(this._enableInput(),this.forwardEvent("cartChange",{changedItem:this.currentDataItem,cartData:t}))}_enableInput(){this.classList.remove("loading")}_updateUI(){this._updateInputValue(),this._updateButtons()}_updateInputValue(){this.$qtyInput.value=this.qtyValue}_updateButtons(){this.$plusButton.disabled=this.qtyValue===this.variantQtyLimit,this.$minusButton.disabled=1===this.qtyValue}_requestCartChanges(){var t=JSON.stringify({id:this.variantId,quantity:this.qtyValue});fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:t,credentials:"same-origin"}).then(t=>200!==t.status?t.status:t.json()).then(this._onCartResponse.bind(this)).catch(t=>{console.error("Error:",t)})}});