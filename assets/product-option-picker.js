(async()=>{const{updateURLParams:i,historyPush:e,parseHTML:n}=await import(window.theme.modules.utils),t=t=>JSON.parse(t.textContent);var a=await import(window.theme.modules.baseComponent);customElements.define("product-option-picker",class extends a.default{elements={variantsJSON:"[data-variants-json]",optionsJSON:"[data-options-with-values]"};render(){console.log("options"),this.isProductPage="product"===this.getAttribute("page-type"),this.variantsData=t(this.$variantsJSON),this.optionsData=t(this.$optionsJSON),this._getDefaultVariant(),this._checkUnavailable(),this.addEventListener("change",this._variantChangeHandler)}_getDefaultVariant(){this.variant=this.variantsData.find(t=>t.id===+this.getAttribute("current-variant"))}_checkUnavailable(){this.optionsData.map((i,e)=>{let n=[...this.variant.options];i.values.map(t=>{n[e]=t;var a=this._findVariantByOptions(n);this._toggleOption(i.name,t,!a)})})}_toggleOption(t,a,i){const e=this.querySelector(`[name="${t}"][value="${a}"`);i?e.setAttribute("data-unavailable",""):e.removeAttribute("data-unavailable")}_variantChangeHandler(t){this._selectVariantByOption(t.target);var{queryURL:a,currentURL:t}=i({variant:this.variant.id},this.sectionId);this.isProductPage&&e(t),this._checkUnavailable(),this._fetchPageWithVariant(a,t=>{this.forwardEvent("variantChange",{html:t,variant:this.variant})})}_selectVariantByOption(a){let i=this.optionsData.findIndex(t=>t.name===a.name);if(a.hasAttribute("data-unavailable"))this.variant=this.variantsData.find(t=>t.options[i]===a.value),this._toogleInputs(a);else{let t=[...this.variant.options];t[i]=a.value,this.variant=this._findVariantByOptions(t),this._updateSwatchLable(a)}}_toogleInputs(){this.variant.options.map((t,a)=>{const i=this.querySelector(`input[value="${t}"][name="${this.optionsData[a].name}"]`);i.checked=!0,this._updateSwatchLable(i)})}_findVariantByOptions(a){return this.variantsData.find(t=>((t,a)=>t.toString()===a.toString())(t.options,a))}_updateSwatchLable(t){t.closest("product-variant-swatch").querySelector("[data-swatch-value]").textContent=t.value}_updateURL(){var t;this.isProductPage&&({currentURL:t}=i({variant:this.variant.id}),e(t))}_fetchPageWithVariant(t,a){return console.log("fetching variant"),this.forwardEvent("variantLoading"),fetch(t).then(t=>t.text()).then(t=>{t=n(t);a(t)})}})})();