(async()=>{var t=await import(window.theme.modules.baseComponent);customElements.define("product-option-picker",class extends t.default{elements={variantsJSON:"[data-variants-json]",optionsJSON:"[data-options-with-values]",value:"[data-swatch-value]"};render(){this.isProductPage="product"===this.getAttribute("page-type"),this.variantsData=JSON.parse(this.$variantsJSON.textContent),this.optionsWithValues=JSON.parse(this.$optionsJSON.textContent),this._getDefaultVariant(),this._checkUnavailable(),this.addEventListener("change",this._variantChangeHandler)}_getDefaultVariant(){this.variant=this.variantsData.find(t=>t.id===+this.getAttribute("current-variant"))}_checkUnavailable(){this.optionsWithValues.map((t,i)=>{let e=[...this.variant.options];t.values.map(t=>{e[i]=t;var a=this.variantsData.find(t=>t.options.toString()===e.toString());this._toggleOption(t,i,!a)})})}_toggleOption(t,a,i){const e=document.querySelector(`[data-option-value="${t}"][data-option-position="${a+1}"]`),n=e.querySelector("input");e.style.outline=i?"2px solid red":"",i?n.setAttribute("data-unavailable",""):n.removeAttribute("data-unavailable","")}_variantChangeHandler(t){t.target.hasAttribute("data-unavailable")&&this._findAvailableVariant(t.target),this._updateSwatchLable(t.target),this._updateURL(),this._checkUnavailable(),this._fetchPageWithVariant(t=>{this.forwardEvent("variantChange",{html:t,variant:this.variant})})}_findVariantByOptions(){this.variant=this.variantsData.find(t=>t.options.every((t,a)=>t===this.options[a]))}_findAvailableVariant(t){const a=t.dataset.optionsPosition-1,i=t.value;this.variant=this.variantsData.find(t=>t.options[a]===i),this._selectCurrentVariant()}_selectCurrentVariant(){this.variant.options.map((t,a)=>{const i=document.querySelector(`[value="${t}"][data-options-position="${a+1}"]`);i.checked=!0,this._updateSwatchLable(i)})}_updateSwatchLable(t){t.closest("product-variant-swatch").querySelector("[data-swatch-value]").textContent=t.value}_updateURL(){this.isProductPage&&this._updateUrlParam()}_updateUrlParam(){this.variant?.id?this._handleUrlParams("has")?this._handleUrlParams("set",this.variant.id):this._handleUrlParams("append",this.variant.id):this._handleUrlParams("delete")}_handleUrlParams=(t,a)=>{let i=new URL(window.location.href);if("has"===t)return i.searchParams[t]("variant");i.searchParams[t]("variant",a),window.history.pushState("","",i.toString())};_fetchPageWithVariant(a){return fetch(`${this.getAttribute("url")}?variant=${this.variant.id}&section_id=${this.getAttribute("section-id")}`).then(t=>t.text()).then(t=>{t=(new DOMParser).parseFromString(t,"text/html");a(t)})}})})();